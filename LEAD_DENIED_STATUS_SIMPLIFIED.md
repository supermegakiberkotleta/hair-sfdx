# Упрощенная система обработки статуса DENIED лидов

## Обзор

Система была упрощена и теперь работает синхронно в триггере без использования очередей, батчей и других асинхронных процессов.

## Архитектура

### Компоненты

1. **LeadDeniedStatusTrigger** - триггер (before update), который срабатывает при обновлении лидов
2. **LeadDeniedStatusHandler** - хелпер-класс для обработки логики
3. **LeadDeniedStatusConfig** - конфигурация правил для изменения статуса

### Логика работы

1. Триггер срабатывает при изменении статуса лида на 'DENIED' (before update)
2. Проверяется RecordTypeId (должен быть '012Kc000000tenuIAA')
3. Проверяются значения полей согласно конфигурации
4. Если условия выполняются, статус изменяется на 'Final Denied' прямо в триггере

## Конфигурация

Правила настраиваются в классе `LeadDeniedStatusConfig`:

```apex
private static final Map<String, List<String>> FIELD_VALUES_CONFIG = new Map<String, List<String>>{
    'Parsing_Status__c' => new List<String>{
        'Black list',
        'black list', 
        'BLACK LIST'
    }
    // Можно добавить другие поля
};
```

## Преимущества упрощенной системы

1. **Простота** - нет сложных асинхронных процессов
2. **Надежность** - обработка происходит сразу при изменении
3. **Производительность** - нет накладных расходов на очереди
4. **Отладка** - легче отслеживать и исправлять ошибки
5. **Тестирование** - проще писать и поддерживать тесты
6. **Эффективность** - изменения происходят в одном DML операторе

## Использование

Система работает автоматически. При изменении статуса лида на 'DENIED' с правильным RecordTypeId, система автоматически проверит условия и при необходимости изменит статус на 'Final Denied' в том же обновлении.

## Тестирование

Для тестирования используется класс `LeadDeniedStatusHandlerTest`, который покрывает все основные сценарии:

- Обработка лидов с условиями для обновления
- Обработка лидов без условий для обновления
- Проверка различных значений полей
- Интеграционное тестирование с триггером (before update)
- Тестирование изменения статуса на Final Denied

## Технические детали

- **Триггер**: before update (позволяет изменять поля до сохранения)
- **Обработка**: синхронная, без очередей
- **Конфигурация**: статическая в коде (легко изменять)
- **Производительность**: один DML оператор для всех изменений 