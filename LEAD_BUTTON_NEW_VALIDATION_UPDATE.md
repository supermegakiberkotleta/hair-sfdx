# Lead Button New - Validation Update

## Обзор изменений

Компонент `leadButtonNew` был обновлен для добавления валидации обязательного поля `Reason_for_Send_to_onloan_second__c` перед отправкой данных в Ocrolus.

## Основные изменения

### 1. JavaScript (leadButtonNew.js)

- **Добавлен импорт поля**: `REASON_FIELD` из схемы Lead
- **Добавлен wire service**: для получения значения поля в реальном времени
- **Добавлена валидация**: проверка заполненности поля перед отправкой
- **Добавлена обработка ошибок**: с отображением toast сообщений и уведомлений
- **Улучшена подсветка поля**: двойной подход - через события и прямую DOM манипуляцию
- **Добавлен геттер buttonClass**: для динамического стиля кнопки

### 2. HTML (leadButtonNew.html)

- **Упрощен UI**: убраны избыточные элементы и иконки
- **Оставлена только кнопка**: с динамическими стилями
- **Минимальная подсказка**: при ошибке валидации
- **Убраны отступы слева**: для компактности

### 3. CSS (leadButtonNew.css)

- **Убраны лишние стили**: для упрощения
- **Добавлена анимация мигания**: для подсветки поля
- **Убраны отступы слева**: у кнопки
- **Стили для подсвеченного поля**: красная рамка и фон

## Функциональность

### Валидация

1. **Проверка поля**: При нажатии кнопки проверяется заполненность поля `Reason_for_Send_to_onloan_second__c`
2. **Блокировка действия**: Если поле не заполнено, никакие действия не выполняются
3. **Отображение ошибки**: Показывается только toast сообщение (без избыточных баннеров)
4. **Подсветка поля**: Поле подсвечивается красным с анимацией мигания

### Подсветка поля

- **Двойной подход**: 
  - Событие для родительского компонента
  - Прямая DOM манипуляция для немедленной подсветки
- **Визуальные эффекты**: Красная рамка, фон и анимация мигания
- **Автоматический поиск**: Поиск поля по тексту label

### Автоматический сброс ошибки

- Ошибка валидации автоматически сбрасывается при заполнении поля
- Используется wire service для отслеживания изменений в реальном времени

### Уведомления

- **Toast сообщения**: Для информирования пользователя о статусе
- **Системные уведомления**: Отправляются через `NotificationController`
- **Логирование**: Все действия логируются в консоль

## Использование

### В родительском компоненте

```javascript
// Слушаем событие подсветки поля
this.template.addEventListener('highlightfield', (event) => {
    const { fieldName, recordId, action } = event.detail;
    if (action === 'highlight_red') {
        // Логика для подсветки поля красным
        this.highlightFieldRed(fieldName, recordId);
    }
});
```

### Требования

- Поле `Reason_for_Send_to_onloan_second__c` должно быть доступно в объекте Lead
- Компонент `NotificationController` должен быть развернут
- Пользователь должен иметь права на чтение поля Lead

## Тестирование

### Сценарии

1. **Поле не заполнено**: Кнопка заблокирована, показывается toast ошибка, поле подсвечивается красным
2. **Поле заполнено**: Кнопка активна, валидация проходит успешно
3. **Поле очищено**: Ошибка появляется автоматически, поле подсвечивается
4. **Поле заполнено**: Ошибка исчезает автоматически

### Проверка функциональности

- Валидация поля перед отправкой
- Отображение toast ошибок (без избыточных баннеров)
- Автоматический сброс ошибок
- Блокировка кнопки при ошибке
- Подсветка поля красным с анимацией
- Отправка событий для родительского компонента

## Зависимости

- `@salesforce/schema/Lead.Reason_for_Send_to_onloan_second__c`
- `NotificationController.sendNotification`
- Lightning Web Components framework
- SLDS (Salesforce Lightning Design System)

## UI/UX улучшения

- **Упрощенный интерфейс**: Убраны избыточные элементы
- **Компактность**: Убраны лишние отступы слева
- **Эффективная подсветка**: Поле сразу подсвечивается красным
- **Минимализм**: Только необходимые элементы интерфейса
