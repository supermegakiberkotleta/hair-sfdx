# Clear Files Loan Component

## Описание

LWC компонент `clearFilesLoan` предназначен для управления файлами, связанными с записями Lead в Salesforce. Компонент имитирует функционал связанного списка Files, но с кастомным хранением данных в объекте `Clear_files__c`.

## Функциональность

### Основные возможности:
- **Загрузка файлов**: Поддержка изображений, PDF, Word, Excel и текстовых файлов
- **Отображение файлов**: Показ имени, размера, расширения, иконки и даты загрузки
- **Удаление файлов**: Возможность удаления файлов с подтверждением
- **Просмотр файлов**: Клик по имени файла открывает его в новом окне
- **Адаптивный дизайн**: Поддержка мобильных устройств

### Поддерживаемые типы файлов:
- Изображения: JPG, JPEG, PNG, GIF, BMP
- Документы: PDF, DOC, DOCX
- Таблицы: XLS, XLSX
- Текстовые файлы: TXT

### Ограничения:
- Максимальный размер файла: 10MB
- Файлы сохраняются в стандартную систему Files Salesforce
- Связь с Lead осуществляется через объект `Clear_files__c`

## Структура объекта Clear_files__c

```apex
Clear_files__c
├── Lead__c (Lookup(Lead)) - связь с лидом
├── File_Id__c (Text(255)) - ID файла в системе Files
├── CreatedDate - дата создания записи
└── LastModifiedDate - дата последнего изменения
```

## Установка и настройка

### 1. Создание объекта Clear_files__c
Создайте кастомный объект в Salesforce с полями:
- `Lead__c` - Lookup на Lead
- `File_Id__c` - Text(255)

### 2. Развертывание компонента
Разверните следующие файлы:
- `force-app/main/default/lwc/clearFilesLoan/` - LWC компонент
- `force-app/main/default/classes/ClearFilesController.cls` - Apex контроллер

### 3. Добавление на страницу Lead
Добавьте компонент `clearFilesLoan` на страницу записи Lead через Lightning App Builder.

## Использование

### Для пользователей:
1. **Загрузка файла**: Выберите файл через кнопку "Choose File" и нажмите "Upload"
2. **Просмотр файла**: Кликните по имени файла для открытия
3. **Удаление файла**: Нажмите на иконку корзины рядом с файлом

### Для разработчиков:
Компонент автоматически получает `recordId` (ID Lead) и загружает связанные файлы при инициализации.

## Технические детали

### LWC компонент:
- **Файлы**: `clearFilesLoan.js`, `clearFilesLoan.html`, `clearFilesLoan.css`, `clearFilesLoan.js-meta.xml`
- **API версия**: 60.0
- **Целевые страницы**: `lightning__RecordPage` для объекта Lead

### Apex контроллер:
- **Класс**: `ClearFilesController`
- **Методы**:
  - `getClearFilesByLeadId()` - получение файлов по ID лида
  - `saveClearFile()` - сохранение файла
  - `deleteClearFile()` - удаление файла
  - `getFileInfo()` - получение информации о файле
  - `getFileBase64Data()` - получение данных файла в base64

### Безопасность:
- Контроллер использует `with sharing` для соблюдения правил доступа
- Все методы проверяют входные параметры
- Обработка ошибок с информативными сообщениями

## Стилизация

Компонент использует современный дизайн с:
- Карточным интерфейсом
- Hover эффектами
- Анимациями появления элементов
- Адаптивной версткой
- Цветовой схемой Salesforce Lightning

## Возможные улучшения

1. **Drag & Drop**: Добавление возможности перетаскивания файлов
2. **Превью**: Показ миниатюр для изображений
3. **Поиск**: Фильтрация файлов по имени или типу
4. **Сортировка**: Изменение порядка отображения файлов
5. **Массовые операции**: Выбор и удаление нескольких файлов одновременно

## Устранение неполадок

### Частые проблемы:
1. **Файл не загружается**: Проверьте размер файла (максимум 10MB) и поддерживаемый тип
2. **Ошибка доступа**: Убедитесь, что у пользователя есть права на создание/удаление записей `Clear_files__c`
3. **Файл не отображается**: Проверьте, что объект `Clear_files__c` создан и настроен правильно

### Логирование:
Все операции логируются в консоль браузера для отладки.

## Поддержка

При возникновении проблем проверьте:
1. Консоль браузера на наличие ошибок JavaScript
2. Логи Salesforce на наличие ошибок Apex
3. Права доступа пользователя к объектам и полям
4. Корректность настройки объекта `Clear_files__c`
