# Обновление компонента ScanLicence

## Обзор изменений

Компонент `scanLicence` был полностью переработан для поддержки различных типов файлов вместо только изображений. Теперь компонент может работать с PDF, изображениями и другими документами, передавая base64 данные файлов в API.

## Основные изменения

### 1. Поддержка различных типов файлов
- **Раньше**: Только изображения (`image/*`)
- **Теперь**: Изображения, PDF, документы Word (`image/*,.pdf,.doc,.docx`)

### 2. Изменение API запросов
- **Раньше**: Передача base64 изображения в поле `image`
- **Теперь**: Передача base64 данных файла в поле `fileData` и имени файла в поле `fileName`

### 3. Улучшенный пользовательский интерфейс
- Отображение типа файла с соответствующими иконками
- Показ размера файла
- Превью только для изображений
- Улучшенная обработка ошибок

## Технические изменения

### Apex контроллеры

#### LicenseScanController.cls
```apex
// Раньше
public static String scanLicence(String base64Image, String endpointUrl)

// Теперь  
public static String scanLicence(String base64Data, String fileName, String endpointUrl)
```

#### ScanDataController.cls
```apex
// Раньше
public static Scan_Data__c saveScanData(String leadId, String base64Image, String fileName, String scannedName)

// Теперь
public static Scan_Data__c saveScanData(String leadId, String fileName, String base64Data, String scannedName)
```

### LWC компонент

#### Новые свойства
- `fileType` - тип загруженного файла
- `fileSize` - размер файла в читаемом формате
- `selectedFile` - выбранный файл (вместо `base64Image`)

#### Новые геттеры
- `isImageFile()` - проверка, является ли файл изображением
- `isPdfFile()` - проверка, является ли файл PDF
- `isOtherFile()` - проверка других типов файлов

#### Обновленная логика
1. Загрузка файла с проверкой размера (максимум 10MB)
2. Чтение файла в base64 формат
3. Передача base64 данных и имени файла в API
4. Сохранение файла в Salesforce Files
5. Обновление записи с результатом сканирования

## Процесс работы

1. **Загрузка файла**: Пользователь выбирает файл (изображение, PDF, документ)
2. **Валидация**: Проверка размера файла и типа
3. **Чтение файла**: Файл читается в base64 формат
4. **API запрос**: Base64 данные и имя файла передаются в API для сканирования
5. **Обработка результата**: Извлеченное имя сохраняется в Lead
6. **Сохранение файла**: Файл сохраняется в Salesforce Files для истории

## API изменения

### Формат запроса
```json
// Раньше
{
  "image": "base64_encoded_image_data"
}

// Теперь
{
  "fileData": "base64_encoded_file_data",
  "fileName": "document.pdf"
}
```

## Тестирование

Обновлены все тесты для работы с новыми параметрами:
- `LicenseScanControllerTest.cls` - тесты для работы с base64 данными и именем файла
- `ScanDataControllerTest.cls` - тесты для работы с файлами

## Совместимость

⚠️ **Важно**: API сервер должен быть обновлен для поддержки параметров `fileData` и `fileName` вместо `image`.

## Ограничения

- Максимальный размер файла: 5MB
- Поддерживаемые форматы: изображения (JPG, JPEG, PNG, GIF, BMP), PDF, DOC, DOCX
- Превью доступно только для изображений

## Развертывание

1. Обновить Apex классы
2. Обновить LWC компонент
3. Развернуть Remote Site Settings для доменов:
   - `https://lenderpro.itprofit.net`
   - `https://lenderpro.ai`
4. Убедиться, что API сервер поддерживает новый формат запроса
5. Протестировать с различными типами файлов

## Сравнение с FileUploader

Компонент `scanLicence` теперь работает по аналогии с `fileUploader`:
- Использует тот же подход к чтению файлов в base64
- Передает данные файла напрямую в API
- Сохраняет файлы в Salesforce Files для истории
- Поддерживает различные типы файлов 