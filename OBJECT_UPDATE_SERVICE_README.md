# ObjectUpdateService - Сервис обновления объектов через Flow

## Описание

`ObjectUpdateService` - это универсальный класс для обновления записей Salesforce через Flow Builder. Класс позволяет обновлять любые объекты по переданным параметрам: коллекции ID записей, типу объекта и JSON с полями для обновления.

## Возможности

- ✅ Обновление любых объектов Salesforce
- ✅ Массовое обновление записей
- ✅ Валидация входных параметров
- ✅ Обработка ошибок
- ✅ Подробная отчетность о результатах
- ✅ Использование в Flow Builder
- ✅ Полное покрытие тестами

## Использование в Flow

### Входные параметры

1. **Collection of Record IDs** (recordIds) - Коллекция ID записей для обновления
2. **Object Type** (objectType) - Тип объекта (например: Lead, Account, Contact)
3. **Fields JSON** (fieldsJson) - JSON строка с полями и значениями для обновления

### Выходные параметры

1. **Success** - Успешность операции (Boolean)
2. **Message** - Сообщение о результате (String)
3. **Updated Records Count** - Количество обновленных записей (Integer)
4. **Error Details** - Детали ошибки (String)

## Примеры использования

### Пример 1: Обновление Lead записей

**Входные параметры:**
- Collection of Record IDs: `["00QKc000006OxrxMAC", "00QKc000006OyM7MAK"]`
- Object Type: `Lead`
- Fields JSON: `{"Status": "Closed Lost", "Reason_For_Closure__c": "Not Interest"}`

**Результат:**
- Success: `true`
- Message: `"Успешно обновлено 2 записей"`
- Updated Records Count: `2`
- Error Details: `null`

### Пример 2: Обновление Account записей

**Входные параметры:**
- Collection of Record IDs: `["001000000000001AAA", "001000000000002BBB"]`
- Object Type: `Account`
- Fields JSON: `{"Type": "Customer", "Industry": "Technology", "Rating": "Hot"}`

### Пример 3: Обновление Contact записей

**Входные параметры:**
- Collection of Record IDs: `["003000000000001AAA"]`
- Object Type: `Contact`
- Fields JSON: `{"Title": "Senior Manager", "Department": "Sales", "Phone": "+1234567890"}`

## Формат JSON

JSON должен содержать пары "поле": "значение":

```json
{
  "Status": "Closed Lost",
  "Reason_For_Closure__c": "Not Interest",
  "Custom_Field__c": "Custom Value"
}
```

### Поддерживаемые типы данных:
- String
- Number
- Boolean
- Date (в формате ISO 8601)
- DateTime (в формате ISO 8601)

## Обработка ошибок

Сервис обрабатывает следующие типы ошибок:

1. **Пустые параметры** - Если не заполнены обязательные поля
2. **Неверный JSON** - Если JSON имеет неправильный формат
3. **Несуществующий тип объекта** - Если указан неверный API Name объекта
4. **Несуществующие поля** - Поля, которых нет в объекте, игнорируются
5. **DML ошибки** - Ошибки при сохранении записей

## Настройка Flow

1. Добавьте элемент "Action" в ваш Flow
2. Выберите "ObjectUpdateService.updateObjects"
3. Настройте входные параметры:
   - Создайте переменную для коллекции ID записей
   - Укажите тип объекта
   - Создайте переменную с JSON строкой
4. Настройте выходные параметры для обработки результатов

## Пример Flow Builder

```
Start → Get Records → ObjectUpdateService → Decision → End
```

1. **Get Records** - Получение записей для обновления
2. **ObjectUpdateService** - Обновление записей
3. **Decision** - Проверка результата (Success = true/false)
4. **End** - Завершение Flow

## Тестирование

Класс включает полное покрытие тестами:

- ✅ Успешное обновление Lead записей
- ✅ Успешное обновление Account записей
- ✅ Обработка пустых параметров
- ✅ Обработка неверного JSON
- ✅ Обработка несуществующего типа объекта
- ✅ Обработка несуществующих ID записей
- ✅ Обработка несуществующих полей
- ✅ Множественные запросы

## Ограничения

- Максимум 200 записей за один вызов (лимит Salesforce)
- Поля должны существовать в схеме объекта
- Пользователь должен иметь права на обновление записей
- JSON должен быть валидным

## Безопасность

- Класс использует `with sharing` для соблюдения правил доступа
- Проверяется существование полей перед обновлением
- Валидация всех входных параметров
- Обработка исключений для предотвращения ошибок Flow

## Поддержка

Для вопросов и предложений обращайтесь к команде разработки QueueHair.
